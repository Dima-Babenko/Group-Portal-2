{% extends 'base/base.html' %}
{% load static %}

{% block content %}
<div class="container">
    <h2 class="mb-4">Галерея</h2>

    <!-- Фильтр по типу медіа -->
    <form method="get" class="mb-3">
        <label for="type">Фільтр:</label>
        <select name="type" id="type" onchange="this.form.submit()">
            <option value="">Усі</option>
            <option value="image" {% if media_type == 'image' %}selected{% endif %}>Зображення</option>
            <option value="video" {% if media_type == 'video' %}selected{% endif %}>Відео</option>
        </select>
    </form>

    <div class="mb-3">
        <a href="{% url 'gallery:add_media' %}" class="btn btn-success">Додати медіа</a>
    </div>

    <div class="row">
        {% for media in media_files %}
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">{{ media.title }}</h5>

                        {% if media.media_type == 'image' and media.file %}
                            <img src="{{ media.file.url }}" class="img-fluid" alt="{{ media.title }}">
                        {% elif media.media_type == 'video' and media.file %}
                            <video class="img-fluid" controls>
                                <source src="{{ media.file.url }}">
                                Ваш браузер не підтримує відео.
                            </video>
                        {% elif media.youtube_url %}
                            {% with media.youtube_url|cut:"watch?v=" as embed_url %}
                                <iframe src="{{ embed_url|add:'embed/' }}" frameborder="0" allowfullscreen></iframe>
                            {% endwith %}
                        {% endif %}

                        <div class="mt-3 d-flex justify-content-between">
                            <a href="{% url 'gallery:edit_media' pk=media.pk %}" class="btn btn-primary btn-sm">Редагувати</a>
                            <a href="{% url 'gallery:delete_media' pk=media.pk %}" class="btn btn-danger btn-sm">Видалити</a>
                        </div>
                    </div>
                </div>
            </div>
        {% empty %}
            <p>Наразі немає медіа.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}

